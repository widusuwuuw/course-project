Omnihealth 技术架构与设计哲学报告
—— 基于医学规则引擎校正的 AI 个性化健康系统

1. 项目愿景与设计哲学
1.1 核心定义
本项目不仅仅是一个“健康记录工具”或“视频播放平台”，而是一个 “由医学规则引擎严格校正的 AI 智能教练系统”。

1.2 设计哲学：神经符号人工智能 (Neuro-Symbolic AI) 的工程实践
我们采用了 “符号主义（规则）+ 联结主义（AI）” 相结合的混合架构。 在医疗健康这一特殊领域，纯粹依赖大模型（LLM）存在“幻觉”风险，且缺乏严谨性；而纯粹的规则系统又缺乏人性化的交互体验。因此，我们的设计哲学是：

用规则确立边界（Certainty & Safety）：利用确定性的医学规则引擎处理核心生理数据，确保结论的医学严谨性和安全性。

用 AI 提升体验（Empathy & Flexibility）：利用大模型处理自然语言交互和个性化文案生成，提供有温度的建议。

2. 系统核心架构：Omnihealth "Medical Brain"
我们将传统的 MVC 架构升维，构建了一个以 “医学大脑（Medical Brain）” 为核心的决策分层架构。

第一层：全息数据层 (Holographic Data Layer)
不仅仅存储“当前状态”，而是存储“生命周期”。

多维健康档案：包含用户基础信息、体检报告 OCR 结构化数据、生活方式标签。

医学元数据化资源：将运动课程、营养建议等静态资源进行“医学标签化”重构（如标注禁忌症、代谢当量 METs、冲击等级），使其能够被机器逻辑所理解和计算。

第二层：医学规则引擎层 (The Deterministic Core)
这是系统的“脊梁”，负责所有不可妥协的逻辑判断。它不依赖 AI，而是依赖预设的、可热更新的 rules.json 配置。

职责：负责清洗数据、判定异常、计算趋势、生成硬性约束（Constraints）。

第三层：AI 代理与应用层 (The Generative Layer)
这是系统的“面孔”。它不直接通过原始数据做决策，而是接收规则引擎输出的“指令”和“约束”，在此框架下进行生成。

3. 三大深度功能（工程核心目的）
为了体现软件工程的深度，我们在“情境”中挖掘了三个核心功能点。它们共同构成了系统的数据闭环。

深度功能一：基于时间维度的纵向趋势审计 (Longitudinal Trend Audit)
设计目的：从“离散点判定”进化为“连续流监控”

设计哲学： 传统的体检系统只关注“当前值是否超标”（横向对比）。但医学上，指标在正常范围内的剧烈波动往往是病变的早期信号。本功能旨在建立一套动态的时间序列分析机制。

核心逻辑： 系统在录入新数据时，会自动回溯历史快照，计算变化率（Slope）和波动幅度（Delta）。规则引擎将引入 Trend Rules，例如“肌酐值在30天内上升超过20%即触发预警”，即使当前值仍在正常范围内。

工程价值： 体现了对**复杂时变数据（Time-variant Data）**的建模能力，以及对数据历史一致性的维护能力。

深度功能二：基于事实锚定的 AI 幻觉抑制系统 (Constraint-Based AI Safety)
设计目的：解决医疗 AI “一本正经胡说八道”的信任危机

设计哲学： 在医疗场景下，AI 的“创造力”是危险的。我们需要给 AI 穿上“紧身衣”。这套机制被称为 RAG-like Safety Layer（类检索增强安全层）。

核心逻辑： AI 在回答用户健康咨询前，系统会强制执行一次“事实锚定”流程：

事实提取：规则引擎先对用户数据进行评估，生成一组结构化的“医学事实”（如：Uric_Acid: High, Risk: Gout）。

约束注入：将上述事实转化为 System Prompt 中的硬性指令（如：“用户存在痛风风险，严禁推荐海鲜饮食”）。

生成控制：AI 仅能在这些硬性指令划定的安全范围内进行语言组织。

工程价值： 展示了**系统鲁棒性（Robustness）**设计，以及如何通过传统的确定性代码来治理概率性的 AI 模型。

深度功能三：动态约束驱动的个性化运动处方 (Dynamic Prescription System)
设计目的：从“内容分发”进化为“医疗级匹配”

设计哲学： 市面上的健身 App 逻辑是“推荐我觉得你会喜欢的”，而 Omnihealth 的逻辑是“过滤掉你绝对不能做的，推荐你现在最需要的”。这是一种**基于排他性逻辑（Exclusionary Logic）**的推荐系统。

核心逻辑： 我们将运动推荐过程重构为**“漏斗筛选”**模型：

禁忌映射：规则引擎根据体检异常（如高血压、关节损伤），输出“运动禁忌标签”（如 Avoid: High_Impact, Avoid: Head_Down_Postures）。

数据库过滤：利用医学元数据，在数据库层面直接剔除所有包含禁忌标签的课程。

处方生成：从剩余的安全池中，匹配最适合用户当前体能状态的课程，生成“本日运动处方”。

工程价值： 体现了**领域驱动设计（DDD）**的思想，将复杂的医学业务规则转化为清晰的数据库查询策略，实现了真正的千人千面。

4. 总结与展望
本技术架构旨在构建一个闭环的健康管理生态：

检测：通过纵向趋势分析，精准捕捉身体变化。

诊断：通过 AI 幻觉抑制机制，提供安全可靠的初步建议。

干预：通过动态运动处方，提供可执行的改善方案。

这套架构不仅满足了用户对“Keep + 丁香医生”结合体的需求，更在软件工程层面展示了对数据一致性、算法安全性和业务逻辑深度的极致追求。