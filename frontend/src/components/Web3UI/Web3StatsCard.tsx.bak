import React from 'react';
import { View, Text, StyleSheet, ViewStyle } from 'react-native';
import { LinearGradient } from 'expo-linear-gradient';
import { BlurView } from 'expo-blur';
import GlassCard from './GlassCard';

interface Web3StatsCardProps {
  title: string;
  value: string | number;
  unit?: string;
  change?: {
    value: string;
    trend: 'up' | 'down' | 'neutral';
  };
  icon?: React.ReactNode;
  gradient?: string[];
  variant?: 'default' | 'neon' | 'glass';
  size?: 'sm' | 'md' | 'lg';
  style?: ViewStyle;
}

export const Web3StatsCard: React.FC<Web3StatsCardProps> = ({
  title,
  value,
  unit = '',
  change,
  icon,
  gradient = ['rgba(139, 92, 246, 0.1)', 'rgba(59, 130, 246, 0.1)'],
  variant = 'default',
  size = 'md',
  style,
}) => {
  const getSizeConfig = () => {
    switch (size) {
      case 'sm':
        return {
          padding: 16,
          titleSize: 12,
          valueSize: 20,
          unitSize: 10,
          changeSize: 10,
        };
      case 'lg':
        return {
          padding: 32,
          titleSize: 16,
          valueSize: 36,
          unitSize: 14,
          changeSize: 14,
        };
      default:
        return {
          padding: 24,
          titleSize: 14,
          valueSize: 28,
          unitSize: 12,
          changeSize: 12,
        };
    }
  };

  const { padding, titleSize, valueSize, unitSize, changeSize } = getSizeConfig();

  const getTrendColor = () => {
    switch (change?.trend) {
      case 'up':
        return '#10B981';
      case 'down':
        return '#EF4444';
      default:
        return '#9CA3AF';
    }
  };

  const getTrendIcon = () => {
    switch (change?.trend) {
      case 'up':
        return '↑';
      case 'down':
        return '↓';
      default:
        return '→';
    }
  };

  if (variant === 'neon') {
    return (
      <View style={[styles.neonContainer, style]}>
        <LinearGradient
          colors={gradient}
          style={styles.neonGradient}
          start={{ x: 0, y: 0 }}
          end={{ x: 1, y: 1 }}
        />
        <View style={[styles.neonContent, { padding }]}>
          {icon && <View style={styles.iconContainer}>{icon}</View>}

          <Text style={[styles.neonTitle, { fontSize: titleSize }]}>
            {title}
          </Text>

          <View style={styles.valueContainer}>
            <Text style={[styles.neonValue, { fontSize: valueSize }]}>
              {value}
            </Text>
            {unit && (
              <Text style={[styles.neonUnit, { fontSize: unitSize }]}>
                {unit}
              </Text>
            )}
          </View>

          {change && (
            <View style={styles.changeContainer}>
              <Text style={[
                styles.neonChange,
                {
                  fontSize: changeSize,
                  color: getTrendColor(),
                }
              ]}>
                {getTrendIcon()} {change.value}
              </Text>
            </View>
          )}
        </View>
      </View>
    );
  }

  return (
    <GlassCard
      style={[styles.container, style]}
      gradient={gradient}
      intensity={variant === 'glass' ? 100 : 80}
    >
      <View style={[styles.content, { padding }]}>
        {icon && <View style={styles.iconContainer}>{icon}</View>}

        <Text style={[styles.title, { fontSize: titleSize }]}>
          {title}
        </Text>

        <View style={styles.valueContainer}>
          <Text style={[styles.value, { fontSize: valueSize }]}>
            {value}
          </Text>
          {unit && (
            <Text style={[styles.unit, { fontSize: unitSize }]}>
              {unit}
            </Text>
          )}
        </View>

        {change && (
          <View style={styles.changeContainer}>
            <Text style={[
              styles.change,
              {
                fontSize: changeSize,
                color: getTrendColor(),
              }
            ]}>
              {getTrendIcon()} {change.value}
            </Text>
          </View>
        )}
      </View>
    </GlassCard>
  );
};

const styles = StyleSheet.create({
  container: {
    position: 'relative',
  },
  content: {
    position: 'relative',
  },
  iconContainer: {
    position: 'absolute',
    top: 0,
    right: 0,
  },
  title: {
    color: '#9CA3AF',
    fontWeight: '500',
    marginBottom: 8,
  },
  valueContainer: {
    flexDirection: 'row',
    alignItems: 'baseline',
    marginBottom: 8,
  },
  value: {
    color: '#FFFFFF',
    fontWeight: '700',
  },
  unit: {
    color: '#6B7280',
    marginLeft: 4,
    fontWeight: '400',
  },
  changeContainer: {
    alignSelf: 'flex-start',
  },
  change: {
    fontWeight: '500',
  },

  // Neon variant
  neonContainer: {
    borderRadius: 20,
    overflow: 'hidden',
    borderWidth: 1,
    borderColor: 'rgba(139, 92, 246, 0.3)',
    shadowColor: '#8B5CF6',
    shadowOpacity: 0.3,
    shadowRadius: 12,
    elevation: 6,
  },
  neonGradient: {
    position: 'absolute',
    top: 0,
    left: 0,
    right: 0,
    bottom: 0,
  },
  neonContent: {
    position: 'relative',
  },
  neonTitle: {
    color: '#D1D5DB',
    fontWeight: '500',
    marginBottom: 8,
  },
  neonValue: {
    color: '#FFFFFF',
    fontWeight: '800',
    textShadowColor: 'rgba(139, 92, 246, 0.5)',
    textShadowRadius: 4,
  },
  neonUnit: {
    color: '#9CA3AF',
    marginLeft: 4,
    fontWeight: '400',
  },
  neonChange: {
    fontWeight: '600',
  },
});

export default Web3StatsCard;