import React from 'react';
import {
  TextInput,
  View,
  Text,
  StyleSheet,
  TextInputProps,
  ViewStyle,
  TextStyle,
  Platform,
} from 'react-native';

// Input variants inspired by ShadCN and medical app design
export type InputVariant =
  | 'default'     // Standard input
  | 'filled'      // Filled background
  | 'outlined'    // Outlined border
  | 'underlined'  // Bottom border only
  | 'success'     // Success state
  | 'error'       // Error state
  | 'warning';    // Warning state

export type InputSize = 'small' | 'medium' | 'large';

interface InputProps extends Omit<TextInputProps, 'style'> {
  label?: string;
  helperText?: string;
  error?: boolean;
  success?: boolean;
  warning?: boolean;
  variant?: InputVariant;
  size?: InputSize;
  leftIcon?: React.ReactNode;
  rightIcon?: React.ReactNode;
  containerStyle?: ViewStyle;
  inputStyle?: TextStyle;
  labelStyle?: TextStyle;
  helperTextStyle?: TextStyle;
}

export const Input: React.FC<InputProps> = ({
  label,
  helperText,
  error = false,
  success = false,
  warning = false,
  variant = 'outlined',
  size = 'medium',
  leftIcon,
  rightIcon,
  containerStyle,
  inputStyle,
  labelStyle,
  helperTextStyle,
  ...textInputProps
}) => {
  // Determine variant based on state
  const getVariant = (): InputVariant => {
    if (error) return 'error';
    if (success) return 'success';
    if (warning) return 'warning';
    return variant;
  };

  const currentVariant = getVariant();

  const containerStyles = [
    styles.container,
    styles[size],
    containerStyle,
  ];

  const inputStyles = [
    styles.input,
    styles[size],
    styles[currentVariant],
    leftIcon && styles.inputWithLeftIcon,
    rightIcon && styles.inputWithRightIcon,
    inputStyle,
  ];

  const labelStyles = [
    styles.label,
    styles[`${size}Label`],
    styles[`${currentVariant}Label`],
    labelStyle,
  ];

  const helperTextStyles = [
    styles.helperText,
    styles[`${size}HelperText`],
    styles[`${currentVariant}HelperText`],
    helperTextStyle,
  ];

  return (
    <View style={containerStyles}>
      {label && <Text style={labelStyles}>{label}</Text>}

      <View style={styles.inputContainer}>
        {leftIcon && <View style={styles.leftIconContainer}>{leftIcon}</View>}

        <TextInput
          style={inputStyles}
          placeholderTextColor={getPlaceholderTextColor(currentVariant)}
          {...textInputProps}
        />

        {rightIcon && <View style={styles.rightIconContainer}>{rightIcon}</View>}
      </View>

      {helperText && <Text style={helperTextStyles}>{helperText}</Text>}
    </View>
  );
};

const getPlaceholderTextColor = (variant: InputVariant): string => {
  switch (variant) {
    case 'error': return '#FCA5A5';
    case 'success': return '#86EFAC';
    case 'warning': return '#FCD34D';
    default: return '#9CA3AF';
  }
};

const styles = StyleSheet.create({
  // Container
  container: {
    width: '100%',
  },
  small: {
    marginVertical: 4,
  },
  medium: {
    marginVertical: 8,
  },
  large: {
    marginVertical: 12,
  },

  // Input container
  inputContainer: {
    flexDirection: 'row',
    alignItems: 'center',
    position: 'relative',
  },

  // Input styles
  input: {
    borderRadius: 8,
    fontSize: 16,
    color: '#111827',
    backgroundColor: '#FFFFFF',
    paddingHorizontal: 16,
    paddingVertical: 12,
    borderWidth: 1.5,
    borderColor: '#E5E7EB',
  },
  inputWithLeftIcon: {
    paddingLeft: 48,
  },
  inputWithRightIcon: {
    paddingRight: 48,
  },

  // Size variants
  small: {
    fontSize: 14,
    paddingHorizontal: 12,
    paddingVertical: 8,
    borderRadius: 6,
  },
  medium: {
    fontSize: 16,
    paddingHorizontal: 16,
    paddingVertical: 12,
    borderRadius: 8,
  },
  large: {
    fontSize: 18,
    paddingHorizontal: 20,
    paddingVertical: 16,
    borderRadius: 12,
  },

  // Variant styles
  default: {
    borderColor: '#E5E7EB',
    backgroundColor: '#FFFFFF',
  },
  filled: {
    borderColor: 'transparent',
    backgroundColor: '#F9FAFB',
    borderWidth: 0,
  },
  outlined: {
    borderColor: '#E5E7EB',
    backgroundColor: '#FFFFFF',
  },
  underlined: {
    borderColor: 'transparent',
    borderTopWidth: 0,
    borderLeftWidth: 0,
    borderRightWidth: 0,
    borderBottomWidth: 2,
    borderBottomColor: '#E5E7EB',
    borderRadius: 0,
    paddingHorizontal: 0,
  },
  success: {
    borderColor: '#10B981',
    backgroundColor: '#F0FDF4',
  },
  error: {
    borderColor: '#EF4444',
    backgroundColor: '#FEF2F2',
  },
  warning: {
    borderColor: '#F59E0B',
    backgroundColor: '#FFFBEB',
  },

  // Label styles
  label: {
    fontSize: 14,
    fontWeight: '600',
    marginBottom: 6,
    color: '#374151',
  },
  smallLabel: {
    fontSize: 12,
    marginBottom: 4,
  },
  mediumLabel: {
    fontSize: 14,
    marginBottom: 6,
  },
  largeLabel: {
    fontSize: 16,
    marginBottom: 8,
  },
  defaultLabel: { color: '#374151' },
  successLabel: { color: '#059669' },
  errorLabel: { color: '#DC2626' },
  warningLabel: { color: '#D97706' },

  // Helper text styles
  helperText: {
    fontSize: 12,
    marginTop: 4,
    lineHeight: 16,
  },
  smallHelperText: {
    fontSize: 11,
    marginTop: 3,
  },
  mediumHelperText: {
    fontSize: 12,
    marginTop: 4,
  },
  largeHelperText: {
    fontSize: 13,
    marginTop: 6,
  },
  defaultHelperText: { color: '#6B7280' },
  successHelperText: { color: '#059669' },
  errorHelperText: { color: '#DC2626' },
  warningHelperText: { color: '#D97706' },

  // Icon containers
  leftIconContainer: {
    position: 'absolute',
    left: 16,
    zIndex: 1,
    alignItems: 'center',
    justifyContent: 'center',
  },
  rightIconContainer: {
    position: 'absolute',
    right: 16,
    zIndex: 1,
    alignItems: 'center',
    justifyContent: 'center',
  },

  // Platform specific adjustments
  ...Platform.select({
    web: {
      input: {
        outlineStyle: 'none',
      },
    },
  }),
});

export default Input;